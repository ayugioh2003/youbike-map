{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "..\\App.svelte",
    "..\\Comment.svelte"
  ],
  "sourcesContent": [
    "<script>\r\n  import Comment from './Comment.svelte';\r\n\r\n  let range = 1000;\r\n  let location = null;\r\n  let points = [];\r\n  $: recentPoints = getRecentPoints(points, range, location);\r\n  const KEY = 'AIzaSyCjDnDGv67nvhzBsLRYAwTbiF1HrZBQDUM';\r\n\r\n  $: currentPosMarker = location ? `&markers=${location.lat},${location.lng}` : undefined;\r\n\r\n  const locateOption = {\r\n    enableHighAccuracy: true,\r\n    timeout: 5000,\r\n    maximumAge: 0\r\n  };\r\n\r\n  function getLocation () {\r\n    return new Promise((resolve, reject) => {\r\n      navigator.geolocation.getCurrentPosition(resolve, reject, locateOption);\r\n    });\r\n  };\r\n\r\n  async function setLocate() {\r\n    let position = await getLocation();\r\n    location = {\r\n      lat: position.coords.latitude,\r\n      lng: position.coords.longitude,\r\n      acc: position.coords.accuracy,\r\n    };\r\n    console.log('setLocate', location);\r\n  }\r\n\r\n  async function fetchData() {\r\n    setLocate();\r\n    console.log('fetchData');\r\n\r\n    // Taipei\r\n    const api_taipei = 'https://tcgbusfs.blob.core.windows.net/blobyoubike/YouBikeTP.json'\r\n    const res_taipei = await fetch(api_taipei).then(d => d.json())\r\n    console.log('fetch TaipeiData done', res_taipei);\r\n    const list_taipei = Object.values(res_taipei.retVal);\r\n\r\n\r\n    // Taoyuan\r\n    const cors = \"https://cors-anywhere.herokuapp.com/\"\r\n    let taoyuan_api = \"https://data.tycg.gov.tw/api/v1/rest/datastore/a1b4714b-3b75-4ff8-a8f2-cc377e4eaa0f?format=json&limit=500\"\r\n    taoyuan_api = cors + taoyuan_api\r\n    const res_taoyuan = await fetch(taoyuan_api).then(d => d.json())\r\n    console.log('fetch TaoyuanData done', res_taoyuan);\r\n    const list_taoyuan = res_taoyuan.result.records;\r\n\r\n\r\n    // combine taipei, taoyuan data into points array\r\n    points = [...list_taoyuan, ...list_taipei];\r\n  };\r\n\r\n  function getRecentPoints(points, range, location) {\r\n    console.log('getRecentPoints');\r\n    points = points.map(p => {\r\n      p.img = getImgSrc(p);\r\n      return p;\r\n    });\r\n\r\n    if (location) {\r\n      points = points.filter(p => {\r\n        const distance = GreatCircleDistance([\r\n          location.lng,\r\n          location.lat,\r\n          p.lng,\r\n          p.lat\r\n        ]);\r\n        p.distance = distance.toFixed();\r\n        return distance < range;\r\n      })\r\n    }\r\n\r\n    return points.sort((a, b) => a.distance - b.distance);\r\n  }\r\n\r\n  // https://en.wikipedia.org/wiki/Great-circle_distance\r\n  // https://gist.github.com/thesadabc/f84adeea5644149539dae968ccdb3f2c\r\n  function GreatCircleDistance(points) {\r\n    let [lng1, lat1, lng2, lat2] = points;\r\n    if (!lng1 || !lat1 || !lng2 || !lat2) return null;\r\n    [lng1, lat1, lng2, lat2] = points.map(n => n * Math.PI / 180)\r\n    const R = 6371000; // average earth radius(m)\r\n    const C = Math.sin(lat1) * Math.sin(lat2) +\r\n      Math.cos(lng1 - lng2) * Math.cos(lat1) * Math.cos(lat2);\r\n    return R * Math.acos(C);\r\n  }\r\n\r\n  function getImgSrc(target, size = 300) {\r\n    let p0 = target;\r\n    let p1;\r\n\r\n    if (location) {\r\n      p0 = location;\r\n      p1 = target;\r\n    }\r\n\r\n    return (\r\n      'https://maps.googleapis.com/maps/api/staticmap'\r\n      + `?size=${size}x${size}`\r\n      + `&center=${p0.lat},${p0.lng}`\r\n      + `&markers=size:mid|${p0.lat},${p0.lng}`\r\n      + (p1 ? `&markers=color:yellow|label:T|${p1.lat},${p1.lng}` : '')\r\n      + `&key=${KEY}`\r\n    );\r\n  }\r\n\r\n  fetchData();\r\n</script>\r\n\r\n\r\n\r\n<!--  -->\r\n\r\n\r\n\r\n<nav class=\"ctrl\">\r\n  <button id=\"locate\" on:click={setLocate}>定位</button>\r\n  <button id=\"refetch\" on:click={fetchData}>更新</button>\r\n  <div>\r\n    <span>距: {range} m</span>\r\n    <br>\r\n    <input type=\"range\" id=\"range\" bind:value={range} max=\"5000\" min=\"10\" step=\"50\" />\r\n  </div>\r\n</nav>\r\n\r\n<ol class=\"list\">\r\n  {#each recentPoints as point (point.sno)}\r\n    <li class=\"item\" value={point.sno}>\r\n\r\n      <div class=\"d-f jc-sb ai-c\">\r\n        <div>\r\n          <div>{point.sna}</div>\r\n        </div>\r\n\r\n        <div class=\"numbers d-f ai-c fs-0\">\r\n          <span class=\"sum\">{point.tot}</span>\r\n          <hr>\r\n          <div>\r\n            <div class=\"bike\">車 {point.sbi}</div>\r\n            <div class=\"empty\">空 {point.bemp}</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <details class=\"details\">\r\n        <summary class=\"summary\">\r\n          {point.distance} m\r\n        </summary>\r\n        <a href=\"http://maps.google.com?q={point.lat},{point.lng}\" target=\"_blank\" title=\"google map link\">{point.lat}, {point.lng}\r\n        </a>\r\n        <a class=\"img\" style=\"--url: url({point.img})\" href={point.img} target=\"_blank\">_</a>\r\n      </details>\r\n    </li>\r\n  {/each}\r\n</ol>\r\n\r\n\r\n<footer class=\"footer d-f\">\r\n  <header>\r\n    <h1>YouBike Map</h1>\r\n  </header>\r\n  <!-- <Comment /> -->\r\n\r\n  <ul class=\"info\">\r\n    <li>\r\n        Fork From: <a href=\"https://github.com/rplus/youbike-map\">Rplus / Youbike-Map</a>\r\n    </li>\r\n    <li>\r\n      GitHub: <a href=\"https://github.com/ayugioh2003/youbike-map\">ayugioh2003 / Youbike-Map</a>\r\n    </li>\r\n    <li>\r\n      Relesed with: <a href=\"https://github.com/Rplus/youbike-map/blob/master/LICENSE\">MIT license</a>\r\n    </li>\r\n    <li>\r\n      資料來源:\r\n      <br>\r\n      <a href=\"https://taipeicity.github.io/traffic_realtime/\">臺北市政府 交通即時資料 開放資料專區</a>\r\n      <br>\r\n      <a href=\"https://data.tycg.gov.tw/opendata/datalist/datasetMeta?oid=5ca2bfc7-9ace-4719-88ae-4034b9a5a55c\">桃園市政府 桃園公共自行車即時服務資料</a>\r\n    </li>\r\n  </ul>\r\n  <div style=\"text-align: center; padding-bottom: 2rem;\">\r\n    (只能查找臺北、桃園地區)<br>\r\n    (桃園資料來源可能會有點不穩定，斟酌參考)\r\n  </div>\r\n</footer>\r\n\r\n\r\n\r\n<!--  -->\r\n\r\n\r\n\r\n<style>\r\n  .ctrl {\r\n    position: fixed;\r\n    top: 0;\r\n    z-index: 1;\r\n    height: 3em;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-evenly;\r\n    width: 400px;\r\n    max-width: 100%;\r\n    background-color: #ffe;\r\n  }\r\n\r\n  .list {\r\n    padding: 3em .5em;\r\n  }\r\n\r\n  .item {\r\n    margin-bottom: 1em;\r\n    display: block;\r\n    padding-bottom: 1em;\r\n    border-bottom: 1px dotted #ccc;\r\n  }\r\n\r\n  .sum { color: #999; }\r\n  .bike { padding-bottom: .25em; }\r\n  .empty { color: #999; }\r\n\r\n  .details {\r\n    margin-top: 1em;\r\n    margin-left: 2em;\r\n    max-width: 100%;\r\n  }\r\n\r\n  .summary {\r\n    opacity: .4;\r\n  }\r\n\r\n  .img {\r\n    display: block;\r\n    width: 300px;\r\n    height: 300px;\r\n    max-width: 100%;\r\n    word-break: break-all;\r\n    color: transparent;\r\n  }\r\n\r\n  :global(details[open]) .img {\r\n    background-color: #cfc;\r\n    background-image: var(--url);\r\n  }\r\n\r\n  .info {\r\n    align-self: center;\r\n    font-family: monospace;\r\n  }\r\n\r\n  .footer {\r\n    position: relative;\r\n    z-index: 2;\r\n    min-height: 100vh;\r\n    background-color: #eef;\r\n    flex-direction: column;\r\n  }\r\n\r\n  header {\r\n    text-align: center;\r\n    border-bottom: 1px dashed #aaa;\r\n  }\r\n\r\n  .d-f {\r\n    display: flex;\r\n  }\r\n\r\n  .ai-c { align-items: center; }\r\n  .jc-sb { justify-content: space-between; }\r\n  .fs-0 { flex-shrink: 0; }\r\n\r\n  .d-f hr {\r\n    align-self: stretch;\r\n    margin: 0 .5em;\r\n  }\r\n\r\n  :global(body) {\r\n    max-width: 400px;\r\n    margin: 0 auto;\r\n    overflow-y: scroll;\r\n  }\r\n\r\n  :global(*) {\r\n    box-sizing: border-box;\r\n  }\r\n</style>\r\n",
    "<script>\r\n  let open;\r\n\r\n  function initDisqus(e) {\r\n    if (!open) { return; }\r\n    console.log('initDisqus');\r\n\r\n    if (window.DISQUS) {\r\n      window.DISQUS.reset({\r\n        reload: true,\r\n      });\r\n      return;\r\n    }\r\n    (function() {\r\n      var d = document, s = d.createElement('script');\r\n      s.src = 'https://rplus-youbike-map.disqus.com/embed.js';\r\n      s.setAttribute('data-timestamp', +new Date());\r\n      (d.head || d.body).appendChild(s);\r\n    })();\r\n  }\r\n\r\n  function onToggle(e) {\r\n    console.log(1111111111, e);\r\n    open = e.target.open;\r\n    initDisqus();\r\n  }\r\n</script>\r\n\r\n<details on:toggle={onToggle}>\r\n  <summary>開啟留言</summary>\r\n  <div>\r\n    <div id=\"disqus_thread\"></div>\r\n  </div>\r\n</details>\r\n\r\n\r\n<style>\r\n  details {\r\n    padding: 1em;\r\n    margin-top: auto;\r\n    margin-bottom: auto;\r\n  }\r\n</style>\r\n"
  ],
  "names": [],
  "mappings": "AAuME,KAAK,4BAAC,CAAC,AACL,QAAQ,CAAE,KAAK,CACf,GAAG,CAAE,CAAC,CACN,OAAO,CAAE,CAAC,CACV,MAAM,CAAE,GAAG,CACX,OAAO,CAAE,IAAI,CACb,WAAW,CAAE,MAAM,CACnB,eAAe,CAAE,YAAY,CAC7B,KAAK,CAAE,KAAK,CACZ,SAAS,CAAE,IAAI,CACf,gBAAgB,CAAE,IAAI,AACxB,CAAC,AAED,KAAK,4BAAC,CAAC,AACL,OAAO,CAAE,GAAG,CAAC,IAAI,AACnB,CAAC,AAED,KAAK,4BAAC,CAAC,AACL,aAAa,CAAE,GAAG,CAClB,OAAO,CAAE,KAAK,CACd,cAAc,CAAE,GAAG,CACnB,aAAa,CAAE,GAAG,CAAC,MAAM,CAAC,IAAI,AAChC,CAAC,AAED,IAAI,4BAAC,CAAC,AAAC,KAAK,CAAE,IAAI,AAAE,CAAC,AACrB,KAAK,4BAAC,CAAC,AAAC,cAAc,CAAE,KAAK,AAAE,CAAC,AAChC,MAAM,4BAAC,CAAC,AAAC,KAAK,CAAE,IAAI,AAAE,CAAC,AAEvB,QAAQ,4BAAC,CAAC,AACR,UAAU,CAAE,GAAG,CACf,WAAW,CAAE,GAAG,CAChB,SAAS,CAAE,IAAI,AACjB,CAAC,AAED,QAAQ,4BAAC,CAAC,AACR,OAAO,CAAE,EAAE,AACb,CAAC,AAED,IAAI,4BAAC,CAAC,AACJ,OAAO,CAAE,KAAK,CACd,KAAK,CAAE,KAAK,CACZ,MAAM,CAAE,KAAK,CACb,SAAS,CAAE,IAAI,CACf,UAAU,CAAE,SAAS,CACrB,KAAK,CAAE,WAAW,AACpB,CAAC,AAEO,aAAa,AAAC,CAAC,IAAI,4BAAC,CAAC,AAC3B,gBAAgB,CAAE,IAAI,CACtB,gBAAgB,CAAE,IAAI,KAAK,CAAC,AAC9B,CAAC,AAED,KAAK,4BAAC,CAAC,AACL,UAAU,CAAE,MAAM,CAClB,WAAW,CAAE,SAAS,AACxB,CAAC,AAED,OAAO,4BAAC,CAAC,AACP,QAAQ,CAAE,QAAQ,CAClB,OAAO,CAAE,CAAC,CACV,UAAU,CAAE,KAAK,CACjB,gBAAgB,CAAE,IAAI,CACtB,cAAc,CAAE,MAAM,AACxB,CAAC,AAED,MAAM,4BAAC,CAAC,AACN,UAAU,CAAE,MAAM,CAClB,aAAa,CAAE,GAAG,CAAC,MAAM,CAAC,IAAI,AAChC,CAAC,AAED,IAAI,4BAAC,CAAC,AACJ,OAAO,CAAE,IAAI,AACf,CAAC,AAED,KAAK,4BAAC,CAAC,AAAC,WAAW,CAAE,MAAM,AAAE,CAAC,AAC9B,MAAM,4BAAC,CAAC,AAAC,eAAe,CAAE,aAAa,AAAE,CAAC,AAC1C,KAAK,4BAAC,CAAC,AAAC,WAAW,CAAE,CAAC,AAAE,CAAC,AAEzB,kBAAI,CAAC,EAAE,cAAC,CAAC,AACP,UAAU,CAAE,OAAO,CACnB,MAAM,CAAE,CAAC,CAAC,IAAI,AAChB,CAAC,AAEO,IAAI,AAAE,CAAC,AACb,SAAS,CAAE,KAAK,CAChB,MAAM,CAAE,CAAC,CAAC,IAAI,CACd,UAAU,CAAE,MAAM,AACpB,CAAC,AAEO,CAAC,AAAE,CAAC,AACV,UAAU,CAAE,UAAU,AACxB,CAAC;AC7PD,OAAO,cAAC,CAAC,AACP,OAAO,CAAE,GAAG,CACZ,UAAU,CAAE,IAAI,CAChB,aAAa,CAAE,IAAI,AACrB,CAAC"
}